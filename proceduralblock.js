var ProceduralBlock = function( center, size, segments, density, material ) {
    THREE.Object3D.call( this );
    this.position.copy( center );
    this.density = density;
    this.size = size;
    this.segments = segments;
    this.material = material;
    this._prev = null; // reference to the previous geometry object
    this.ready = false;

    // 
    this._vs = [
        new THREE.Vector3(),
        new THREE.Vector3(),
        new THREE.Vector3(),
        new THREE.Vector3(),
        new THREE.Vector3(),
        new THREE.Vector3(),
        new THREE.Vector3(),
        new THREE.Vector3(),
    ];

    // placeholder until the .update() will create the geometry
    // var _box = new THREE.Box3().setFromCenterAndSize( new THREE.Vector3(), this.size );
    // this._debug_box( _box, 1 );
};

ProceduralBlock.prototype = Object.create( THREE.Object3D.prototype );
ProceduralBlock.prototype.update = function() {
    this.ready = false;
    this._box = new THREE.Box3().setFromCenterAndSize( new THREE.Vector3(), this.size );
    this._vertices = [];
    this._faces = [];
    
    this._densities = [];
    this._build_densities();
};

ProceduralBlock.prototype._build_next_voxel = function( corners ) {

    var case_ = 0;
    for ( var c = corners.length - 1 ; c >= 0 ; c -= 1 ) {
        case_ <<= 1;
        case_ |= ( corners[ c ].density < 0 ) ? 0 : 1;
    }

    var triangles = this.case_map[ case_ ];
    for ( var t = 0 ; t < triangles.length ; t += 1 ) {
        var n1, n2, n3;
        for ( var e = 0 ; e < triangles[ t ].length ; e += 1 ) {
            var edge = triangles[ t ][ e ],
                edge_verts = this.edge_to_vertices[ edge ],
                v1 = corners[ edge_verts[ 0 ] ], // first vertex on the edge
                v2 = corners[ edge_verts[ 1 ] ], // second vertex on the edge
                delta = Math.abs( v1.density ) + Math.abs( v2.density ),
                lerp = Math.abs( v1.density / delta );

            var v1 = new THREE.Vector3( v1.x, v1.y, v1.z ),
                v2 = new THREE.Vector3( v2.x, v2.y, v2. z );
            v1.lerp( v2, lerp );

            this._vertices.push( v1 );
        }

        var l = this._vertices.length,
            face = new THREE.Face3( l - 1, l - 2, l - 3 );

        this._faces.push( face );
    }

};

ProceduralBlock.prototype._build_voxels = function() {
    var densities = this._densities,
        v = new THREE.Vector3(),
        vwidth = this.size.x / this.segments,
        vheight = this.size.y / this.segments,
        vdepth = this.size.z / this.segments;

    for ( var x = 0 ; x < this.segments ; x += 1 ) {
        for ( var y = 0 ; y < this.segments ; y += 1 ) {
            for ( var z = 0 ; z < this.segments ; z += 1 ) {

                var corners = [
                    densities[ x     ][ y     ][ z + 1 ],
                    densities[ x     ][ y + 1 ][ z + 1 ],
                    densities[ x + 1 ][ y + 1 ][ z + 1 ],
                    densities[ x + 1 ][ y     ][ z + 1 ],
                    densities[ x     ][ y     ][ z     ],
                    densities[ x     ][ y + 1 ][ z     ],
                    densities[ x + 1 ][ y + 1 ][ z     ],
                    densities[ x + 1 ][ y     ][ z     ],
                ];

                this._build_next_voxel( corners );
            }
        }
    }

    this.swap();

};

ProceduralBlock.prototype._build_densities = function( x, y, z ) {

    if ( !this.parent ) {
        this.ready = true;
        return; // detached from scene, no point to keep going
    }

    x || ( x = 0 );
    y || ( y = 0 );
    z || ( z = 0 );
    var v = new THREE.Vector3(),
        vwidth = this.size.x / this.segments,
        vheight = this.size.y / this.segments,
        vdepth = this.size.z / this.segments;

    //console.log( "Still generating densities..." );
    var i = 2000, done = false;
    while ( i-- > 0 ) {
        this._densities[ x ] || ( this._densities[ x ] = [] );
        this._densities[ x ][ y ] || ( this._densities[ x ][ y ] = [] );

        v.set(
            this._box.min.x + ( x * vwidth ),
            this._box.min.y + ( y * vheight ),
            this._box.min.z + ( z * vdepth )
        );
        this._densities[ x ][ y ][ z ] = { x: v.x, y: v.y, z: v.z };
        this.localToWorld( v );
        this._densities[ x ][ y ][ z ].density = this.density( v );

        z += 1;
        if ( z > this.segments ) {
            z = 0;
            y += 1;
        }
        if ( y > this.segments ) {
            y = 0;
            x += 1;
        }
        if ( x > this.segments ) {
            done = true;
            break;
        }
    }

    if ( done ) {
        this._build_voxels();
    } else {
        var that = this;
        setTimeout( function() {
            that._build_densities( x, y, z );
        }, .10 )
    }
};

ProceduralBlock.prototype.swap = function() {
    var _prev = this._prev;
    if ( this._vertices.length && this._faces.length ) {
        var geo = new THREE.Geometry();
        geo.vertices = this._vertices;
        geo.faces = this._faces;
        geo.computeCentroids();
        geo.mergeVertices();
        geo.computeFaceNormals();
        geo.computeVertexNormals();

        if ( this.onready ) {
            this.onready( this, geo );
        }

        // var up = new THREE.Vector3( 0, 1, 0 ),
        //     original = this.material.color, // new THREE.Color( 0xffffff ),
        //     cliff = new THREE.Color( 0xde993e ),
        //     stone = new THREE.Color( 0x6E6B6C );

        // for ( var f = 0 ; f < geo.faces.length ; f += 1 ) {
        //     for ( var n = 0 ; n < geo.faces[ f ].vertexNormals.length ; n += 1 ) {
        //         var normal = geo.faces[ f ].vertexNormals[ n ],
        //             alpha = ( 1 - normal.dot( up ) ) * 1.2,
        //             c = new THREE.Color().copy( original );


        //         if ( alpha > 0 ) {
        //             c.lerp( cliff, alpha );
        //         } else {
        //             c.lerp( stone, alpha );
        //         }

        //         geo.faces[ f ].vertexColors[ n ] = c;
        //     }
        // }

        var child = new THREE.Mesh( geo, this.material );
        this.add( child );
        this._prev = child;
        this._vertices = [];
        this._faces = [];
    }

    this.remove( _prev );
    //console.log( "BLOCK READY" );
    this.ready = true;
};

//
ProceduralBlock.prototype._debug_box = function( box, segments ) {
    var width = box.max.x - box.min.x;
    var height = box.max.y - box.min.y;
    var depth = box.max.z - box.min.z;

    var geo = new THREE.CubeGeometry( 
        width, 
        height, 
        depth, 
        segments, 
        segments, 
        segments 
    );
    var mat = new THREE.MeshBasicMaterial({ color: 0, wireframe: true });
    var cube = new THREE.Mesh( geo, mat );
    this.add( cube );
};


//
ProceduralBlock.prototype.updateMatrixWorld = function( force ) {
    var update = ( this.matrixWorldNeedsUpdate === true || force === true );
    var rv = THREE.Object3D.prototype.updateMatrixWorld.apply( this, arguments );

    if ( update ) {
        var that = this;
        this.update();
    }
    return rv;
};

ProceduralBlock.prototype.edge_to_vertices = [
   [ 0, 1 ], // 0
   [ 1, 2 ], // 1
   [ 2, 3 ], // 2 
   [ 3, 0 ], // 3

   [ 4, 5 ], // 4
   [ 5, 6 ], // 5 
   [ 6, 7 ], // 6
   [ 7, 4 ], // 7

   [ 0, 4 ], // 8
   [ 1, 5 ], // 9
   [ 2, 6 ], // 10 
   [ 3, 7 ]  // 11
];

ProceduralBlock.prototype.case_map = [
    [ ],
    [ [ 00 , 08 , 03 ] ],
    [ [ 00 , 01 , 09 ] ],
    [ [ 01 , 08 , 03 ] , [ 09 , 08 , 01 ] ],
    [ [ 01 , 02 , 10 ] ],
    [ [ 00 , 08 , 03 ] , [ 01 , 02 , 10 ] ],
    [ [ 09 , 02 , 10 ] , [ 00 , 02 , 09 ] ],
    [ [ 02 , 08 , 03 ] , [ 02 , 10 , 08 ] , [ 10 , 09 , 08 ] ],
    [ [ 03 , 11 , 02 ] ],
    [ [ 00 , 11 , 02 ] , [ 08 , 11 , 00 ] ],
    [ [ 01 , 09 , 00 ] , [ 02 , 03 , 11 ] ],
    [ [ 01 , 11 , 02 ] , [ 01 , 09 , 11 ] , [ 09 , 08 , 11 ] ],
    [ [ 03 , 10 , 01 ] , [ 11 , 10 , 03 ] ],
    [ [ 00 , 10 , 01 ] , [ 00 , 08 , 10 ] , [ 08 , 11 , 10 ] ],
    [ [ 03 , 09 , 00 ] , [ 03 , 11 , 09 ] , [ 11 , 10 , 09 ] ],
    [ [ 09 , 08 , 10 ] , [ 10 , 08 , 11 ] ],
    [ [ 04 , 07 , 08 ] ],
    [ [ 04 , 03 , 00 ] , [ 07 , 03 , 04 ] ],
    [ [ 00 , 01 , 09 ] , [ 08 , 04 , 07 ] ],
    [ [ 04 , 01 , 09 ] , [ 04 , 07 , 01 ] , [ 07 , 03 , 01 ] ],
    [ [ 01 , 02 , 10 ] , [ 08 , 04 , 07 ] ],
    [ [ 03 , 04 , 07 ] , [ 03 , 00 , 04 ] , [ 01 , 02 , 10 ] ],
    [ [ 09 , 02 , 10 ] , [ 09 , 00 , 02 ] , [ 08 , 04 , 07 ] ],
    [ [ 02 , 10 , 09 ] , [ 02 , 09 , 07 ] , [ 02 , 07 , 03 ] , [ 07 , 09 , 04 ] ],
    [ [ 08 , 04 , 07 ] , [ 03 , 11 , 02 ] ],
    [ [ 11 , 04 , 07 ] , [ 11 , 02 , 04 ] , [ 02 , 00 , 04 ] ],
    [ [ 09 , 00 , 01 ] , [ 08 , 04 , 07 ] , [ 02 , 03 , 11 ] ],
    [ [ 04 , 07 , 11 ] , [ 09 , 04 , 11 ] , [ 09 , 11 , 02 ] , [ 09 , 02 , 01 ] ],
    [ [ 03 , 10 , 01 ] , [ 03 , 11 , 10 ] , [ 07 , 08 , 04 ] ],
    [ [ 01 , 11 , 10 ] , [ 01 , 04 , 11 ] , [ 01 , 00 , 04 ] , [ 07 , 11 , 04 ] ],
    [ [ 04 , 07 , 08 ] , [ 09 , 00 , 11 ] , [ 09 , 11 , 10 ] , [ 11 , 00 , 03 ] ],
    [ [ 04 , 07 , 11 ] , [ 04 , 11 , 09 ] , [ 09 , 11 , 10 ] ],
    [ [ 09 , 05 , 04 ] ],
    [ [ 09 , 05 , 04 ] , [ 00 , 08 , 03 ] ],
    [ [ 00 , 05 , 04 ] , [ 01 , 05 , 00 ] ],
    [ [ 08 , 05 , 04 ] , [ 08 , 03 , 05 ] , [ 03 , 01 , 05 ] ],
    [ [ 01 , 02 , 10 ] , [ 09 , 05 , 04 ] ],
    [ [ 03 , 00 , 08 ] , [ 01 , 02 , 10 ] , [ 04 , 09 , 05 ] ],
    [ [ 05 , 02 , 10 ] , [ 05 , 04 , 02 ] , [ 04 , 00 , 02 ] ],
    [ [ 02 , 10 , 05 ] , [ 03 , 02 , 05 ] , [ 03 , 05 , 04 ] , [ 03 , 04 , 08 ] ],
    [ [ 09 , 05 , 04 ] , [ 02 , 03 , 11 ] ],
    [ [ 00 , 11 , 02 ] , [ 00 , 08 , 11 ] , [ 04 , 09 , 05 ] ],
    [ [ 00 , 05 , 04 ] , [ 00 , 01 , 05 ] , [ 02 , 03 , 11 ] ],
    [ [ 02 , 01 , 05 ] , [ 02 , 05 , 08 ] , [ 02 , 08 , 11 ] , [ 04 , 08 , 05 ] ],
    [ [ 10 , 03 , 11 ] , [ 10 , 01 , 03 ] , [ 09 , 05 , 04 ] ],
    [ [ 04 , 09 , 05 ] , [ 00 , 08 , 01 ] , [ 08 , 10 , 01 ] , [ 08 , 11 , 10 ] ],
    [ [ 05 , 04 , 00 ] , [ 05 , 00 , 11 ] , [ 05 , 11 , 10 ] , [ 11 , 00 , 03 ] ],
    [ [ 05 , 04 , 08 ] , [ 05 , 08 , 10 ] , [ 10 , 08 , 11 ] ],
    [ [ 09 , 07 , 08 ] , [ 05 , 07 , 09 ] ],
    [ [ 09 , 03 , 00 ] , [ 09 , 05 , 03 ] , [ 05 , 07 , 03 ] ],
    [ [ 00 , 07 , 08 ] , [ 00 , 01 , 07 ] , [ 01 , 05 , 07 ] ],
    [ [ 01 , 05 , 03 ] , [ 03 , 05 , 07 ] ],
    [ [ 09 , 07 , 08 ] , [ 09 , 05 , 07 ] , [ 10 , 01 , 02 ] ],
    [ [ 10 , 01 , 02 ] , [ 09 , 05 , 00 ] , [ 05 , 03 , 00 ] , [ 05 , 07 , 03 ] ],
    [ [ 08 , 00 , 02 ] , [ 08 , 02 , 05 ] , [ 08 , 05 , 07 ] , [ 10 , 05 , 02 ] ],
    [ [ 02 , 10 , 05 ] , [ 02 , 05 , 03 ] , [ 03 , 05 , 07 ] ],
    [ [ 07 , 09 , 05 ] , [ 07 , 08 , 09 ] , [ 03 , 11 , 02 ] ],
    [ [ 09 , 05 , 07 ] , [ 09 , 07 , 02 ] , [ 09 , 02 , 00 ] , [ 02 , 07 , 11 ] ],
    [ [ 02 , 03 , 11 ] , [ 00 , 01 , 08 ] , [ 01 , 07 , 08 ] , [ 01 , 05 , 07 ] ],
    [ [ 11 , 02 , 01 ] , [ 11 , 01 , 07 ] , [ 07 , 01 , 05 ] ],
    [ [ 09 , 05 , 08 ] , [ 08 , 05 , 07 ] , [ 10 , 01 , 03 ] , [ 10 , 03 , 11 ] ],
    [ [ 05 , 07 , 00 ] , [ 05 , 00 , 09 ] , [ 07 , 11 , 00 ] , [ 01 , 00 , 10 ] , [ 11 , 10 , 00 ] ],
    [ [ 11 , 10 , 00 ] , [ 11 , 00 , 03 ] , [ 10 , 05 , 00 ] , [ 08 , 00 , 07 ] , [ 05 , 07 , 00 ] ],
    [ [ 11 , 10 , 05 ] , [ 07 , 11 , 05 ] ],
    [ [ 10 , 06 , 05 ] ],
    [ [ 00 , 08 , 03 ] , [ 05 , 10 , 06 ] ],
    [ [ 09 , 00 , 01 ] , [ 05 , 10 , 06 ] ],
    [ [ 01 , 08 , 03 ] , [ 01 , 09 , 08 ] , [ 05 , 10 , 06 ] ],
    [ [ 01 , 06 , 05 ] , [ 02 , 06 , 01 ] ],
    [ [ 01 , 06 , 05 ] , [ 01 , 02 , 06 ] , [ 03 , 00 , 08 ] ],
    [ [ 09 , 06 , 05 ] , [ 09 , 00 , 06 ] , [ 00 , 02 , 06 ] ],
    [ [ 05 , 09 , 08 ] , [ 05 , 08 , 02 ] , [ 05 , 02 , 06 ] , [ 03 , 02 , 08 ] ],
    [ [ 02 , 03 , 11 ] , [ 10 , 06 , 05 ] ],
    [ [ 11 , 00 , 08 ] , [ 11 , 02 , 00 ] , [ 10 , 06 , 05 ] ],
    [ [ 00 , 01 , 09 ] , [ 02 , 03 , 11 ] , [ 05 , 10 , 06 ] ],
    [ [ 05 , 10 , 06 ] , [ 01 , 09 , 02 ] , [ 09 , 11 , 02 ] , [ 09 , 08 , 11 ] ],
    [ [ 06 , 03 , 11 ] , [ 06 , 05 , 03 ] , [ 05 , 01 , 03 ] ],
    [ [ 00 , 08 , 11 ] , [ 00 , 11 , 05 ] , [ 00 , 05 , 01 ] , [ 05 , 11 , 06 ] ],
    [ [ 03 , 11 , 06 ] , [ 00 , 03 , 06 ] , [ 00 , 06 , 05 ] , [ 00 , 05 , 09 ] ],
    [ [ 06 , 05 , 09 ] , [ 06 , 09 , 11 ] , [ 11 , 09 , 08 ] ],
    [ [ 05 , 10 , 06 ] , [ 04 , 07 , 08 ] ],
    [ [ 04 , 03 , 00 ] , [ 04 , 07 , 03 ] , [ 06 , 05 , 10 ] ],
    [ [ 01 , 09 , 00 ] , [ 05 , 10 , 06 ] , [ 08 , 04 , 07 ] ],
    [ [ 10 , 06 , 05 ] , [ 01 , 09 , 07 ] , [ 01 , 07 , 03 ] , [ 07 , 09 , 04 ] ],
    [ [ 06 , 01 , 02 ] , [ 06 , 05 , 01 ] , [ 04 , 07 , 08 ] ],
    [ [ 01 , 02 , 05 ] , [ 05 , 02 , 06 ] , [ 03 , 00 , 04 ] , [ 03 , 04 , 07 ] ],
    [ [ 08 , 04 , 07 ] , [ 09 , 00 , 05 ] , [ 00 , 06 , 05 ] , [ 00 , 02 , 06 ] ],
    [ [ 07 , 03 , 09 ] , [ 07 , 09 , 04 ] , [ 03 , 02 , 09 ] , [ 05 , 09 , 06 ] , [ 02 , 06 , 09 ] ],
    [ [ 03 , 11 , 02 ] , [ 07 , 08 , 04 ] , [ 10 , 06 , 05 ] ],
    [ [ 05 , 10 , 06 ] , [ 04 , 07 , 02 ] , [ 04 , 02 , 00 ] , [ 02 , 07 , 11 ] ],
    [ [ 00 , 01 , 09 ] , [ 04 , 07 , 08 ] , [ 02 , 03 , 11 ] , [ 05 , 10 , 06 ] ],
    [ [ 09 , 02 , 01 ] , [ 09 , 11 , 02 ] , [ 09 , 04 , 11 ] , [ 07 , 11 , 04 ] , [ 05 , 10 , 06 ] ],
    [ [ 08 , 04 , 07 ] , [ 03 , 11 , 05 ] , [ 03 , 05 , 01 ] , [ 05 , 11 , 06 ] ],
    [ [ 05 , 01 , 11 ] , [ 05 , 11 , 06 ] , [ 01 , 00 , 11 ] , [ 07 , 11 , 04 ] , [ 00 , 04 , 11 ] ],
    [ [ 00 , 05 , 09 ] , [ 00 , 06 , 05 ] , [ 00 , 03 , 06 ] , [ 11 , 06 , 03 ] , [ 08 , 04 , 07 ] ],
    [ [ 06 , 05 , 09 ] , [ 06 , 09 , 11 ] , [ 04 , 07 , 09 ] , [ 07 , 11 , 09 ] ],
    [ [ 10 , 04 , 09 ] , [ 06 , 04 , 10 ] ],
    [ [ 04 , 10 , 06 ] , [ 04 , 09 , 10 ] , [ 00 , 08 , 03 ] ],
    [ [ 10 , 00 , 01 ] , [ 10 , 06 , 00 ] , [ 06 , 04 , 00 ] ],
    [ [ 08 , 03 , 01 ] , [ 08 , 01 , 06 ] , [ 08 , 06 , 04 ] , [ 06 , 01 , 10 ] ],
    [ [ 01 , 04 , 09 ] , [ 01 , 02 , 04 ] , [ 02 , 06 , 04 ] ],
    [ [ 03 , 00 , 08 ] , [ 01 , 02 , 09 ] , [ 02 , 04 , 09 ] , [ 02 , 06 , 04 ] ],
    [ [ 00 , 02 , 04 ] , [ 04 , 02 , 06 ] ],
    [ [ 08 , 03 , 02 ] , [ 08 , 02 , 04 ] , [ 04 , 02 , 06 ] ],
    [ [ 10 , 04 , 09 ] , [ 10 , 06 , 04 ] , [ 11 , 02 , 03 ] ],
    [ [ 00 , 08 , 02 ] , [ 02 , 08 , 11 ] , [ 04 , 09 , 10 ] , [ 04 , 10 , 06 ] ],
    [ [ 03 , 11 , 02 ] , [ 00 , 01 , 06 ] , [ 00 , 06 , 04 ] , [ 06 , 01 , 10 ] ],
    [ [ 06 , 04 , 01 ] , [ 06 , 01 , 10 ] , [ 04 , 08 , 01 ] , [ 02 , 01 , 11 ] , [ 08 , 11 , 01 ] ],
    [ [ 09 , 06 , 04 ] , [ 09 , 03 , 06 ] , [ 09 , 01 , 03 ] , [ 11 , 06 , 03 ] ],
    [ [ 08 , 11 , 01 ] , [ 08 , 01 , 00 ] , [ 11 , 06 , 01 ] , [ 09 , 01 , 04 ] , [ 06 , 04 , 01 ] ],
    [ [ 03 , 11 , 06 ] , [ 03 , 06 , 00 ] , [ 00 , 06 , 04 ] ],
    [ [ 06 , 04 , 08 ] , [ 11 , 06 , 08 ] ],
    [ [ 07 , 10 , 06 ] , [ 07 , 08 , 10 ] , [ 08 , 09 , 10 ] ],
    [ [ 00 , 07 , 03 ] , [ 00 , 10 , 07 ] , [ 00 , 09 , 10 ] , [ 06 , 07 , 10 ] ],
    [ [ 10 , 06 , 07 ] , [ 01 , 10 , 07 ] , [ 01 , 07 , 08 ] , [ 01 , 08 , 00 ] ],
    [ [ 10 , 06 , 07 ] , [ 10 , 07 , 01 ] , [ 01 , 07 , 03 ] ],
    [ [ 01 , 02 , 06 ] , [ 01 , 06 , 08 ] , [ 01 , 08 , 09 ] , [ 08 , 06 , 07 ] ],
    [ [ 02 , 06 , 09 ] , [ 02 , 09 , 01 ] , [ 06 , 07 , 09 ] , [ 00 , 09 , 03 ] , [ 07 , 03 , 09 ] ],
    [ [ 07 , 08 , 00 ] , [ 07 , 00 , 06 ] , [ 06 , 00 , 02 ] ],
    [ [ 07 , 03 , 02 ] , [ 06 , 07 , 02 ] ],
    [ [ 02 , 03 , 11 ] , [ 10 , 06 , 08 ] , [ 10 , 08 , 09 ] , [ 08 , 06 , 07 ] ],
    [ [ 02 , 00 , 07 ] , [ 02 , 07 , 11 ] , [ 00 , 09 , 07 ] , [ 06 , 07 , 10 ] , [ 09 , 10 , 07 ] ],
    [ [ 01 , 08 , 00 ] , [ 01 , 07 , 08 ] , [ 01 , 10 , 07 ] , [ 06 , 07 , 10 ] , [ 02 , 03 , 11 ] ],
    [ [ 11 , 02 , 01 ] , [ 11 , 01 , 07 ] , [ 10 , 06 , 01 ] , [ 06 , 07 , 01 ] ],
    [ [ 08 , 09 , 06 ] , [ 08 , 06 , 07 ] , [ 09 , 01 , 06 ] , [ 11 , 06 , 03 ] , [ 01 , 03 , 06 ] ],
    [ [ 00 , 09 , 01 ] , [ 11 , 06 , 07 ] ],
    [ [ 07 , 08 , 00 ] , [ 07 , 00 , 06 ] , [ 03 , 11 , 00 ] , [ 11 , 06 , 00 ] ],
    [ [ 07 , 11 , 06 ] ],
    [ [ 07 , 06 , 11 ] ],
    [ [ 03 , 00 , 08 ] , [ 11 , 07 , 06 ] ],
    [ [ 00 , 01 , 09 ] , [ 11 , 07 , 06 ] ],
    [ [ 08 , 01 , 09 ] , [ 08 , 03 , 01 ] , [ 11 , 07 , 06 ] ],
    [ [ 10 , 01 , 02 ] , [ 06 , 11 , 07 ] ],
    [ [ 01 , 02 , 10 ] , [ 03 , 00 , 08 ] , [ 06 , 11 , 07 ] ],
    [ [ 02 , 09 , 00 ] , [ 02 , 10 , 09 ] , [ 06 , 11 , 07 ] ],
    [ [ 06 , 11 , 07 ] , [ 02 , 10 , 03 ] , [ 10 , 08 , 03 ] , [ 10 , 09 , 08 ] ],
    [ [ 07 , 02 , 03 ] , [ 06 , 02 , 07 ] ],
    [ [ 07 , 00 , 08 ] , [ 07 , 06 , 00 ] , [ 06 , 02 , 00 ] ],
    [ [ 02 , 07 , 06 ] , [ 02 , 03 , 07 ] , [ 00 , 01 , 09 ] ],
    [ [ 01 , 06 , 02 ] , [ 01 , 08 , 06 ] , [ 01 , 09 , 08 ] , [ 08 , 07 , 06 ] ],
    [ [ 10 , 07 , 06 ] , [ 10 , 01 , 07 ] , [ 01 , 03 , 07 ] ],
    [ [ 10 , 07 , 06 ] , [ 01 , 07 , 10 ] , [ 01 , 08 , 07 ] , [ 01 , 00 , 08 ] ],
    [ [ 00 , 03 , 07 ] , [ 00 , 07 , 10 ] , [ 00 , 10 , 09 ] , [ 06 , 10 , 07 ] ],
    [ [ 07 , 06 , 10 ] , [ 07 , 10 , 08 ] , [ 08 , 10 , 09 ] ],
    [ [ 06 , 08 , 04 ] , [ 11 , 08 , 06 ] ],
    [ [ 03 , 06 , 11 ] , [ 03 , 00 , 06 ] , [ 00 , 04 , 06 ] ],
    [ [ 08 , 06 , 11 ] , [ 08 , 04 , 06 ] , [ 09 , 00 , 01 ] ],
    [ [ 09 , 04 , 06 ] , [ 09 , 06 , 03 ] , [ 09 , 03 , 01 ] , [ 11 , 03 , 06 ] ],
    [ [ 06 , 08 , 04 ] , [ 06 , 11 , 08 ] , [ 02 , 10 , 01 ] ],
    [ [ 01 , 02 , 10 ] , [ 03 , 00 , 11 ] , [ 00 , 06 , 11 ] , [ 00 , 04 , 06 ] ],
    [ [ 04 , 11 , 08 ] , [ 04 , 06 , 11 ] , [ 00 , 02 , 09 ] , [ 02 , 10 , 09 ] ],
    [ [ 10 , 09 , 03 ] , [ 10 , 03 , 02 ] , [ 09 , 04 , 03 ] , [ 11 , 03 , 06 ] , [ 04 , 06 , 03 ] ],
    [ [ 08 , 02 , 03 ] , [ 08 , 04 , 02 ] , [ 04 , 06 , 02 ] ],
    [ [ 00 , 04 , 02 ] , [ 04 , 06 , 02 ] ],
    [ [ 01 , 09 , 00 ] , [ 02 , 03 , 04 ] , [ 02 , 04 , 06 ] , [ 04 , 03 , 08 ] ],
    [ [ 01 , 09 , 04 ] , [ 01 , 04 , 02 ] , [ 02 , 04 , 06 ] ],
    [ [ 08 , 01 , 03 ] , [ 08 , 06 , 01 ] , [ 08 , 04 , 06 ] , [ 06 , 10 , 01 ] ],
    [ [ 10 , 01 , 00 ] , [ 10 , 00 , 06 ] , [ 06 , 00 , 04 ] ],
    [ [ 04 , 06 , 03 ] , [ 04 , 03 , 08 ] , [ 06 , 10 , 03 ] , [ 00 , 03 , 09 ] , [ 10 , 09 , 03 ] ],
    [ [ 10 , 09 , 04 ] , [ 06 , 10 , 04 ] ],
    [ [ 04 , 09 , 05 ] , [ 07 , 06 , 11 ] ],
    [ [ 00 , 08 , 03 ] , [ 04 , 09 , 05 ] , [ 11 , 07 , 06 ] ],
    [ [ 05 , 00 , 01 ] , [ 05 , 04 , 00 ] , [ 07 , 06 , 11 ] ],
    [ [ 11 , 07 , 06 ] , [ 08 , 03 , 04 ] , [ 03 , 05 , 04 ] , [ 03 , 01 , 05 ] ],
    [ [ 09 , 05 , 04 ] , [ 10 , 01 , 02 ] , [ 07 , 06 , 11 ] ],
    [ [ 06 , 11 , 07 ] , [ 01 , 02 , 10 ] , [ 00 , 08 , 03 ] , [ 04 , 09 , 05 ] ],
    [ [ 07 , 06 , 11 ] , [ 05 , 04 , 10 ] , [ 04 , 02 , 10 ] , [ 04 , 00 , 02 ] ],
    [ [ 03 , 04 , 08 ] , [ 03 , 05 , 04 ] , [ 03 , 02 , 05 ] , [ 10 , 05 , 02 ] , [ 11 , 07 , 06 ] ],
    [ [ 07 , 02 , 03 ] , [ 07 , 06 , 02 ] , [ 05 , 04 , 09 ] ],
    [ [ 09 , 05 , 04 ] , [ 00 , 08 , 06 ] , [ 00 , 06 , 02 ] , [ 06 , 08 , 07 ] ],
    [ [ 03 , 06 , 02 ] , [ 03 , 07 , 06 ] , [ 01 , 05 , 00 ] , [ 05 , 04 , 00 ] ],
    [ [ 06 , 02 , 08 ] , [ 06 , 08 , 07 ] , [ 02 , 01 , 08 ] , [ 04 , 08 , 05 ] , [ 01 , 05 , 08 ] ],
    [ [ 09 , 05 , 04 ] , [ 10 , 01 , 06 ] , [ 01 , 07 , 06 ] , [ 01 , 03 , 07 ] ],
    [ [ 01 , 06 , 10 ] , [ 01 , 07 , 06 ] , [ 01 , 00 , 07 ] , [ 08 , 07 , 00 ] , [ 09 , 05 , 04 ] ],
    [ [ 04 , 00 , 10 ] , [ 04 , 10 , 05 ] , [ 00 , 03 , 10 ] , [ 06 , 10 , 07 ] , [ 03 , 07 , 10 ] ],
    [ [ 07 , 06 , 10 ] , [ 07 , 10 , 08 ] , [ 05 , 04 , 10 ] , [ 04 , 08 , 10 ] ],
    [ [ 06 , 09 , 05 ] , [ 06 , 11 , 09 ] , [ 11 , 08 , 09 ] ],
    [ [ 03 , 06 , 11 ] , [ 00 , 06 , 03 ] , [ 00 , 05 , 06 ] , [ 00 , 09 , 05 ] ],
    [ [ 00 , 11 , 08 ] , [ 00 , 05 , 11 ] , [ 00 , 01 , 05 ] , [ 05 , 06 , 11 ] ],
    [ [ 06 , 11 , 03 ] , [ 06 , 03 , 05 ] , [ 05 , 03 , 01 ] ],
    [ [ 01 , 02 , 10 ] , [ 09 , 05 , 11 ] , [ 09 , 11 , 08 ] , [ 11 , 05 , 06 ] ],
    [ [ 00 , 11 , 03 ] , [ 00 , 06 , 11 ] , [ 00 , 09 , 06 ] , [ 05 , 06 , 09 ] , [ 01 , 02 , 10 ] ],
    [ [ 11 , 08 , 05 ] , [ 11 , 05 , 06 ] , [ 08 , 00 , 05 ] , [ 10 , 05 , 02 ] , [ 00 , 02 , 05 ] ],
    [ [ 06 , 11 , 03 ] , [ 06 , 03 , 05 ] , [ 02 , 10 , 03 ] , [ 10 , 05 , 03 ] ],
    [ [ 05 , 08 , 09 ] , [ 05 , 02 , 08 ] , [ 05 , 06 , 02 ] , [ 03 , 08 , 02 ] ],
    [ [ 09 , 05 , 06 ] , [ 09 , 06 , 00 ] , [ 00 , 06 , 02 ] ],
    [ [ 01 , 05 , 08 ] , [ 01 , 08 , 00 ] , [ 05 , 06 , 08 ] , [ 03 , 08 , 02 ] , [ 06 , 02 , 08 ] ],
    [ [ 01 , 05 , 06 ] , [ 02 , 01 , 06 ] ],
    [ [ 01 , 03 , 06 ] , [ 01 , 06 , 10 ] , [ 03 , 08 , 06 ] , [ 05 , 06 , 09 ] , [ 08 , 09 , 06 ] ],
    [ [ 10 , 01 , 00 ] , [ 10 , 00 , 06 ] , [ 09 , 05 , 00 ] , [ 05 , 06 , 00 ] ],
    [ [ 00 , 03 , 08 ] , [ 05 , 06 , 10 ] ],
    [ [ 10 , 05 , 06 ] ],
    [ [ 11 , 05 , 10 ] , [ 07 , 05 , 11 ] ],
    [ [ 11 , 05 , 10 ] , [ 11 , 07 , 05 ] , [ 08 , 03 , 00 ] ],
    [ [ 05 , 11 , 07 ] , [ 05 , 10 , 11 ] , [ 01 , 09 , 00 ] ],
    [ [ 10 , 07 , 05 ] , [ 10 , 11 , 07 ] , [ 09 , 08 , 01 ] , [ 08 , 03 , 01 ] ],
    [ [ 11 , 01 , 02 ] , [ 11 , 07 , 01 ] , [ 07 , 05 , 01 ] ],
    [ [ 00 , 08 , 03 ] , [ 01 , 02 , 07 ] , [ 01 , 07 , 05 ] , [ 07 , 02 , 11 ] ],
    [ [ 09 , 07 , 05 ] , [ 09 , 02 , 07 ] , [ 09 , 00 , 02 ] , [ 02 , 11 , 07 ] ],
    [ [ 07 , 05 , 02 ] , [ 07 , 02 , 11 ] , [ 05 , 09 , 02 ] , [ 03 , 02 , 08 ] , [ 09 , 08 , 02 ] ],
    [ [ 02 , 05 , 10 ] , [ 02 , 03 , 05 ] , [ 03 , 07 , 05 ] ],
    [ [ 08 , 02 , 00 ] , [ 08 , 05 , 02 ] , [ 08 , 07 , 05 ] , [ 10 , 02 , 05 ] ],
    [ [ 09 , 00 , 01 ] , [ 05 , 10 , 03 ] , [ 05 , 03 , 07 ] , [ 03 , 10 , 02 ] ],
    [ [ 09 , 08 , 02 ] , [ 09 , 02 , 01 ] , [ 08 , 07 , 02 ] , [ 10 , 02 , 05 ] , [ 07 , 05 , 02 ] ],
    [ [ 01 , 03 , 05 ] , [ 03 , 07 , 05 ] ],
    [ [ 00 , 08 , 07 ] , [ 00 , 07 , 01 ] , [ 01 , 07 , 05 ] ],
    [ [ 09 , 00 , 03 ] , [ 09 , 03 , 05 ] , [ 05 , 03 , 07 ] ],
    [ [ 09 , 08 , 07 ] , [ 05 , 09 , 07 ] ],
    [ [ 05 , 08 , 04 ] , [ 05 , 10 , 08 ] , [ 10 , 11 , 08 ] ],
    [ [ 05 , 00 , 04 ] , [ 05 , 11 , 00 ] , [ 05 , 10 , 11 ] , [ 11 , 03 , 00 ] ],
    [ [ 00 , 01 , 09 ] , [ 08 , 04 , 10 ] , [ 08 , 10 , 11 ] , [ 10 , 04 , 05 ] ],
    [ [ 10 , 11 , 04 ] , [ 10 , 04 , 05 ] , [ 11 , 03 , 04 ] , [ 09 , 04 , 01 ] , [ 03 , 01 , 04 ] ],
    [ [ 02 , 05 , 01 ] , [ 02 , 08 , 05 ] , [ 02 , 11 , 08 ] , [ 04 , 05 , 08 ] ],
    [ [ 00 , 04 , 11 ] , [ 00 , 11 , 03 ] , [ 04 , 05 , 11 ] , [ 02 , 11 , 01 ] , [ 05 , 01 , 11 ] ],
    [ [ 00 , 02 , 05 ] , [ 00 , 05 , 09 ] , [ 02 , 11 , 05 ] , [ 04 , 05 , 08 ] , [ 11 , 08 , 05 ] ],
    [ [ 09 , 04 , 05 ] , [ 02 , 11 , 03 ] ],
    [ [ 02 , 05 , 10 ] , [ 03 , 05 , 02 ] , [ 03 , 04 , 05 ] , [ 03 , 08 , 04 ] ],
    [ [ 05 , 10 , 02 ] , [ 05 , 02 , 04 ] , [ 04 , 02 , 00 ] ],
    [ [ 03 , 10 , 02 ] , [ 03 , 05 , 10 ] , [ 03 , 08 , 05 ] , [ 04 , 05 , 08 ] , [ 00 , 01 , 09 ] ],
    [ [ 05 , 10 , 02 ] , [ 05 , 02 , 04 ] , [ 01 , 09 , 02 ] , [ 09 , 04 , 02 ] ],
    [ [ 08 , 04 , 05 ] , [ 08 , 05 , 03 ] , [ 03 , 05 , 01 ] ],
    [ [ 00 , 04 , 05 ] , [ 01 , 00 , 05 ] ],
    [ [ 08 , 04 , 05 ] , [ 08 , 05 , 03 ] , [ 09 , 00 , 05 ] , [ 00 , 03 , 05 ] ],
    [ [ 09 , 04 , 05 ] ],
    [ [ 04 , 11 , 07 ] , [ 04 , 09 , 11 ] , [ 09 , 10 , 11 ] ],
    [ [ 00 , 08 , 03 ] , [ 04 , 09 , 07 ] , [ 09 , 11 , 07 ] , [ 09 , 10 , 11 ] ],
    [ [ 01 , 10 , 11 ] , [ 01 , 11 , 04 ] , [ 01 , 04 , 00 ] , [ 07 , 04 , 11 ] ],
    [ [ 03 , 01 , 04 ] , [ 03 , 04 , 08 ] , [ 01 , 10 , 04 ] , [ 07 , 04 , 11 ] , [ 10 , 11 , 04 ] ],
    [ [ 04 , 11 , 07 ] , [ 09 , 11 , 04 ] , [ 09 , 02 , 11 ] , [ 09 , 01 , 02 ] ],
    [ [ 09 , 07 , 04 ] , [ 09 , 11 , 07 ] , [ 09 , 01 , 11 ] , [ 02 , 11 , 01 ] , [ 00 , 08 , 03 ] ],
    [ [ 11 , 07 , 04 ] , [ 11 , 04 , 02 ] , [ 02 , 04 , 00 ] ],
    [ [ 11 , 07 , 04 ] , [ 11 , 04 , 02 ] , [ 08 , 03 , 04 ] , [ 03 , 02 , 04 ] ],
    [ [ 02 , 09 , 10 ] , [ 02 , 07 , 09 ] , [ 02 , 03 , 07 ] , [ 07 , 04 , 09 ] ],
    [ [ 09 , 10 , 07 ] , [ 09 , 07 , 04 ] , [ 10 , 02 , 07 ] , [ 08 , 07 , 00 ] , [ 02 , 00 , 07 ] ],
    [ [ 03 , 07 , 10 ] , [ 03 , 10 , 02 ] , [ 07 , 04 , 10 ] , [ 01 , 10 , 00 ] , [ 04 , 00 , 10 ] ],
    [ [ 01 , 10 , 02 ] , [ 08 , 07 , 04 ] ],
    [ [ 04 , 09 , 01 ] , [ 04 , 01 , 07 ] , [ 07 , 01 , 03 ] ],
    [ [ 04 , 09 , 01 ] , [ 04 , 01 , 07 ] , [ 00 , 08 , 01 ] , [ 08 , 07 , 01 ] ],
    [ [ 04 , 00 , 03 ] , [ 07 , 04 , 03 ] ],
    [ [ 04 , 08 , 07 ] ],
    [ [ 09 , 10 , 08 ] , [ 10 , 11 , 08 ] ],
    [ [ 03 , 00 , 09 ] , [ 03 , 09 , 11 ] , [ 11 , 09 , 10 ] ],
    [ [ 00 , 01 , 10 ] , [ 00 , 10 , 08 ] , [ 08 , 10 , 11 ] ],
    [ [ 03 , 01 , 10 ] , [ 11 , 03 , 10 ] ],
    [ [ 01 , 02 , 11 ] , [ 01 , 11 , 09 ] , [ 09 , 11 , 08 ] ],
    [ [ 03 , 00 , 09 ] , [ 03 , 09 , 11 ] , [ 01 , 02 , 09 ] , [ 02 , 11 , 09 ] ],
    [ [ 00 , 02 , 11 ] , [ 08 , 00 , 11 ] ],
    [ [ 03 , 02 , 11 ] ],
    [ [ 02 , 03 , 08 ] , [ 02 , 08 , 10 ] , [ 10 , 08 , 09 ] ],
    [ [ 09 , 10 , 02 ] , [ 00 , 09 , 02 ] ],
    [ [ 02 , 03 , 08 ] , [ 02 , 08 , 10 ] , [ 00 , 01 , 08 ] , [ 01 , 10 , 08 ] ],
    [ [ 01 , 10 , 02 ] ],
    [ [ 01 , 03 , 08 ] , [ 09 , 01 , 08 ] ],
    [ [ 00 , 09 , 01 ] ],
    [ [ 00 , 03 , 08 ] ],
    [ ]
];